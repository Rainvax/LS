<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de An√°lisis Lightning Storm</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #1e40af;
            --secondary-blue: #3b82f6;
            --accent-gold: #f59e0b;
            --success-green: #10b981;
            --danger-red: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.95);
            --border-color: rgba(148, 163, 184, 0.1);
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --gradient-primary: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: auto;
        }

        .dashboard {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .logo-text p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .header-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat-chip {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-chip-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--secondary-blue);
        }

        .stat-chip-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 100px);
        }

        .sidebar {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            height: fit-content;
            position: sticky;
            top: 120px;
        }

        .sidebar-nav {
            padding: 1.5rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 0.925rem;
            font-weight: 500;
            cursor: pointer;
        }

        .nav-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary-blue);
        }

        .nav-item.active {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
        }

        .nav-item i {
            width: 20px;
            text-align: center;
            opacity: 0.8;
        }

        .content-area {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            min-height: 600px;
        }

        .content-header {
            padding: 2rem 2rem 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .content-header h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .content-header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .content-body {
            padding: 2rem;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
        }

        .metric-card.success::before {
            background: linear-gradient(90deg, var(--success-green), #34d399);
        }

        .metric-card.warning::before {
            background: linear-gradient(90deg, var(--accent-gold), #fbbf24);
        }

        .metric-card.danger::before {
            background: linear-gradient(90deg, var(--danger-red), #f87171);
        }

        .metric-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .metric-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary-blue);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .metric-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .metric-change.positive {
            color: var(--success-green);
        }

        .metric-change.negative {
            color: var(--danger-red);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input, .form-select {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.875rem 1rem;
            color: var(--text-primary);
            font-size: 0.925rem;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.5rem;
            border-radius: 8px;
            font-size: 0.925rem;
            font-weight: 600;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            justify-content: center;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: rgba(148, 163, 184, 0.1);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-green), #34d399);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-red), #f87171);
            color: white;
        }

        .wheel-visual {
            width: 300px;
            height: 300px;
            margin: 20px auto;
            border-radius: 50%;
            background: conic-gradient(
                #ff6b6b 0deg 9.23deg,
                #4ecdc4 9.23deg 18.46deg,
                #45b7d1 18.46deg 27.69deg,
                #96ceb4 27.69deg 36.92deg,
                #feca57 36.92deg 46.15deg,
                #ff9ff3 46.15deg 55.38deg,
                #54a0ff 55.38deg 64.61deg,
                #5f27cd 64.61deg 73.84deg
            );
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--border-color);
        }

        .wheel-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 20px solid var(--accent-gold);
            z-index: 10;
        }

        .pattern-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .pattern-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .pattern-title {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--secondary-blue);
        }

        .pattern-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .pattern-stat {
            text-align: center;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .pattern-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-gold);
        }

        .pattern-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .range-analysis {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .range-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--success-green);
            margin-bottom: 1rem;
        }

        .range-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.875rem;
            background: rgba(30, 41, 59, 0.4);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border: 1px solid var(--border-color);
        }

        .data-table {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 1.5rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: rgba(30, 41, 59, 0.8);
            padding: 1rem;
            text-align: left;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .table td {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            font-size: 0.925rem;
        }

        .table tbody tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .number-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .number-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .number-card.hot {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(248, 113, 113, 0.1));
            border-color: rgba(239, 68, 68, 0.3);
        }

        .number-card.hot::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--danger-red), #f87171);
        }

        .number-card.cold {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 197, 253, 0.1));
            border-color: rgba(59, 130, 246, 0.3);
        }

        .number-card.cold::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary-blue), #93c5fd);
        }

        .number-value {
            font-size: 1.75rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .number-stats {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success-green);
            color: var(--success-green);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--danger-red);
            color: var(--danger-red);
        }

        .chart-container {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }

            .sidebar {
                position: static;
                border-radius: 12px 12px 0 0;
            }

            .sidebar-nav {
                display: flex;
                overflow-x: auto;
                padding: 1rem 0;
            }

            .nav-item {
                white-space: nowrap;
                min-width: fit-content;
            }

            .header-stats {
                display: none;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .pattern-grid {
                grid-template-columns: 1fr;
            }

            .numbers-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 0.75rem;
            }
        }

        /* Animaciones adicionales */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Lightning Storm Analytics</h1>
                        <p>Plataforma Profesional de Inteligencia de Juego</p>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="stat-chip">
                        <div class="stat-chip-value" id="header-total-rounds">0</div>
                        <div class="stat-chip-label">Total Giros</div>
                    </div>
                    <div class="stat-chip">
                        <div class="stat-chip-value" id="header-success-rate">0%</div>
                        <div class="stat-chip-label">Tasa de Bonus</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-container">
            <div class="sidebar">
                <nav class="sidebar-nav">
                    <button class="nav-item active" onclick="showSection('data-entry')">
                        <i class="fas fa-plus-circle"></i>
                        Entrada de Datos
                    </button>
                    <button class="nav-item" onclick="showSection('analytics')">
                        <i class="fas fa-chart-line"></i>
                        An√°lisis
                    </button>
                    <button class="nav-item" onclick="showSection('patterns')">
                        <i class="fas fa-sync-alt"></i>
                        Patrones de Giro
                    </button>
                    <button class="nav-item" onclick="showSection('predictions')">
                        <i class="fas fa-brain"></i>
                        Predicciones
                    </button>
                    <button class="nav-item" onclick="showSection('visualization')">
                        <i class="fas fa-chart-bar"></i>
                        Visualizaci√≥n
                    </button>
                    <button class="nav-item" onclick="showSection('reports')">
                        <i class="fas fa-file-alt"></i>
                        Reportes
                    </button>
                    <button class="nav-item" onclick="showSection('settings')">
                        <i class="fas fa-cog"></i>
                        Configuraci√≥n
                    </button>
                </nav>
            </div>

            <div class="content-area">
                <!-- Entrada de Datos -->
                <div id="data-entry" class="section active">
                    <div class="content-header">
                        <h2>Entrada de Datos</h2>
                        <p>Registra nuevos resultados para mantener an√°lisis precisos</p>
                    </div>
                    <div class="content-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Tipo de Resultado</label>
                                <select id="result-type" class="form-select" onchange="toggleResultFields()">
                                    <option value="number">N√∫mero (1-20)</option>
                                    <option value="leaf">Leaf (1:1)</option>
                                </select>
                            </div>
                            <div class="form-group" id="number-group">
                                <label class="form-label">N√∫mero</label>
                                <input type="number" id="number-input" class="form-input" min="1" max="20" placeholder="Ingresa n√∫mero (1-20)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Posici√≥n Inicial</label>
                                <input type="number" id="start-position" class="form-input" min="1" max="39" placeholder="Posici√≥n inicial (1-39)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Direcci√≥n del Giro</label>
                                <select id="spin-direction" class="form-select">
                                    <option value="right">Derecha (Horario)</option>
                                    <option value="left">Izquierda (Antihorario)</option>
                                </select>
                            </div>
                            <div class="form-group" id="bonus-group">
                                <label class="form-label">Bonus</label>
                                <select id="bonus-input" class="form-select">
                                    <option value="false">Sin Bonus</option>
                                    <option value="true">Con Bonus</option>
                                </select>
                            </div>
                            <div class="form-group" id="multiplier-group">
                                <label class="form-label">Multiplicador</label>
                                <input type="number" id="multiplier-input" class="form-input" min="1" step="0.1" value="1.0" placeholder="1.0">
                            </div>
                        </div>
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1.5rem;">
                            <button class="btn btn-primary" onclick="addRound()">
                                <i class="fas fa-plus"></i>
                                Agregar Giro
                            </button>
                            <button class="btn btn-secondary" onclick="quickAddMode()">
                                <i class="fas fa-tachometer-alt"></i>
                                Modo R√°pido
                            </button>
                        </div>
                        <div id="add-result"></div>
                    </div>
                </div>

                <!-- An√°lisis -->
                <div id="analytics" class="section">
                    <div class="content-header">
                        <h2>Panel de An√°lisis</h2>
                        <p>An√°lisis estad√≠stico completo de patrones de juego</p>
                    </div>
                    <div class="content-body">
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-header">
                                    <span class="metric-title">Total de Giros</span>
                                    <div class="metric-icon">
                                        <i class="fas fa-play-circle"></i>
                                    </div>
                                </div>
                                <div class="metric-value" id="total-rounds">0</div>
                                <div class="metric-change">
                                    <span>Actividad de sesi√≥n</span>
                                </div>
                            </div>
                            
                            <div class="metric-card success">
                                <div class="metric-header">
                                    <span class="metric-title">Tasa de Bonus</span>
                                    <div class="metric-icon">
                                        <i class="fas fa-gift"></i>
                                    </div>
                                </div>
                                <div class="metric-value" id="bonus-rate">0%</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>Indicador de rendimiento</span>
                                </div>
                            </div>

                            <div class="metric-card warning">
                                <div class="metric-header">
                                    <span class="metric-title">Racha Actual</span>
                                    <div class="metric-icon">
                                        <i class="fas fa-fire"></i>
                                    </div>
                                </div>
                                <div class="metric-value" id="current-streak">0</div>
                                <div class="metric-change">
                                    <span>Giros sin bonus</span>
                                </div>
                            </div>

                            <div class="metric-card">
                                <div class="metric-header">
                                    <span class="metric-title">Frecuencia Leaf</span>
                                    <div class="metric-icon">
                                        <i class="fas fa-leaf"></i>
                                    </div>
                                </div>
                                <div class="metric-value" id="leaf-rate">0%</div>
                                <div class="metric-change">
                                    <span>Jugadas seguras</span>
                                </div>
                            </div>
                        </div>

                        <div class="range-analysis">
                            <div class="range-title">
                                <i class="fas fa-lightbulb"></i>
                                Recomendaciones Estrat√©gicas
                            </div>
                            <div id="recommendations-list">
                                <!-- Las recomendaciones se poblar√°n aqu√≠ -->
                            </div>
                        </div>

                        <h3 style="margin: 2rem 0 1rem;">An√°lisis de Rendimiento por N√∫mero</h3>
                        <div class="numbers-grid" id="numbers-grid">
                            <!-- Los n√∫meros se poblar√°n aqu√≠ -->
                        </div>
                    </div>
                </div>

                <!-- Patrones de Giro -->
                <div id="patterns" class="section">
                    <div class="content-header">
                        <h2>An√°lisis de Patrones de Giro</h2>
                        <p>An√°lisis avanzado de direcciones y rangos de movimiento</p>
                    </div>
                    <div class="content-body">
                        <div class="pattern-grid">
                            <div class="pattern-card">
                                <div class="pattern-title">
                                    <i class="fas fa-arrow-right"></i>
                                    Giros a la Derecha
                                </div>
                                <div class="pattern-stats">
                                    <div class="pattern-stat">
                                        <div class="pattern-value" id="right-spins-count">0</div>
                                        <div class="pattern-label">Total</div>
                                    </div>
                                    <div class="pattern-stat">
                                        <div class="pattern-value" id="right-avg-distance">0</div>
                                        <div class="pattern-label">Distancia Prom.</div>
                                    </div>
                                    <div class="pattern-stat">
                                        <div class="pattern-value" id="right-bonus-rate">0%</div>
                                        <div class="pattern-label">Tasa Bonus</div>
                                    </div>
                                    <div class="pattern-stat">
                                        <div class="pattern-value" id="right-leaf-rate">0%</div>
                                        <div class="pattern-label">Tasa Leaf</div>
                                    </div>
                                </div>
                            </div>

                            <div class="pattern-card">
                                <div class="pattern-title">
                                    <i class="fas fa-arrow-left"></i>
                                    Giros a la Izquierda
                                </div>
                                <div class="pattern-stats">
                                    <div class="pattern-stat">
                                        <div class="pattern-value" id="left-spins-count">0</div>
                                        <div class="pattern-label">Total</div>
                                    </div>
                                    <div class="pattern-stat">
                                        <div class="pattern-value" id="left-avg-distance">0</div>
                                        <div class="pattern-label">Distancia Prom.</div>
                                    </div>
                                    <div class="pattern-stat">
                                        <div class="pattern-value" id="left-bonus-rate">0%</div>
                                        <div class="pattern-label">Tasa Bonus</div>
                                    </div>
                                    <div class="pattern-stat">
                                        <div class="pattern-value" id="left-leaf-rate">0%</div>
                                        <div class="pattern-label">Tasa Leaf</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="range-analysis">
                            <div class="range-title">
                                <i class="fas fa-chart-area"></i>
                                An√°lisis de Rangos de Movimiento
                            </div>
                            <div id="range-analysis-list">
                                <!-- El an√°lisis de rangos se poblar√° aqu√≠ -->
                            </div>
                        </div>

                        <div class="chart-container">
                            <h3>Distribuci√≥n de Distancias por Direcci√≥n</h3>
                            <canvas id="distanceChart"></canvas>
                        </div>

                        <h3 style="margin: 2rem 0 1rem;">Patrones de Posici√≥n Inicial</h3>
                        <div class="numbers-grid" id="start-positions-grid">
                            <!-- Las posiciones iniciales se poblar√°n aqu√≠ -->
                        </div>
                    </div>
                </div>

                <!-- Predicciones -->
                <div id="predictions" class="section">
                    <div class="content-header">
                        <h2>An√°lisis Predictivo</h2>
                        <p>Simulaciones Monte Carlo para toma de decisiones estrat√©gicas</p>
                    </div>
                    <div class="content-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Giros de Simulaci√≥n</label>
                                <input type="number" id="sim-rounds" class="form-input" value="10" min="1" max="100">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cantidad de Simulaciones</label>
                                <input type="number" id="sim-count" class="form-input" value="1000" min="100" max="10000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Posici√≥n Inicial</label>
                                <input type="number" id="sim-start-pos" class="form-input" value="1" min="1" max="39">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Direcci√≥n</label>
                                <select id="sim-direction" class="form-select">
                                    <option value="both">Ambas</option>
                                    <option value="right">Derecha</option>
                                    <option value="left">Izquierda</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1.5rem;">
                            <button class="btn btn-primary" onclick="runSimulation()">
                                <i class="fas fa-play"></i>
                                Ejecutar Simulaci√≥n
                            </button>
                            <button class="btn btn-secondary" onclick="exportSimulation()">
                                <i class="fas fa-download"></i>
                                Exportar Resultados
                            </button>
                        </div>

                        <div style="display: none; text-align: center; padding: 3rem;" id="sim-loading">
                            <div style="width: 40px; height: 40px; border: 3px solid var(--border-color); border-top: 3px solid var(--secondary-blue); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                            <p>Ejecutando simulaci√≥n Monte Carlo avanzada...</p>
                        </div>

                        <div id="simulation-results" style="display: none;">
                            <div class="chart-container">
                                <h3>Resultados de Simulaci√≥n</h3>
                                <div id="sim-output"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualizaci√≥n -->
                <div id="visualization" class="section">
                    <div class="content-header">
                        <h2>Visualizaci√≥n de Datos</h2>
                        <p>Gr√°ficos interactivos y an√°lisis visuales</p>
                    </div>
                    <div class="content-body">
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem;">
                            <button class="btn btn-primary" onclick="showChart('frequency')">
                                <i class="fas fa-chart-bar"></i>
                                Gr√°fico de Frecuencia
                            </button>
                            <button class="btn btn-secondary" onclick="showChart('bonus')">
                                <i class="fas fa-gift"></i>
                                Gr√°fico de Bonus
                            </button>
                            <button class="btn btn-secondary" onclick="showChart('direction')">
                                <i class="fas fa-sync-alt"></i>
                                An√°lisis Direccional
                            </button>
                            <button class="btn btn-secondary" onclick="showChart('timeline')">
                                <i class="fas fa-chart-line"></i>
                                L√≠nea de Tiempo
                            </button>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Reportes -->
                <div id="reports" class="section">
                    <div class="content-header">
                        <h2>Reportes e Historial</h2>
                        <p>Historial detallado de transacciones y reportes de rendimiento</p>
                    </div>
                    <div class="content-body">
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem;">
                            <button class="btn btn-secondary" onclick="refreshHistory()">
                                <i class="fas fa-sync"></i>
                                Actualizar
                            </button>
                            <button class="btn btn-danger" onclick="clearHistory()">
                                <i class="fas fa-trash"></i>
                                Limpiar Historial
                            </button>
                        </div>

                        <div class="data-table">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Resultado</th>
                                        <th>Pos. Inicial</th>
                                        <th>Direcci√≥n</th>
                                        <th>Distancia</th>
                                        <th>Bonus</th>
                                        <th>Multiplicador</th>
                                        <th>Fecha</th>
                                    </tr>
                                </thead>
                                <tbody id="history-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Configuraci√≥n -->
                <div id="settings" class="section">
                    <div class="content-header">
                        <h2>Configuraci√≥n y Exportaci√≥n</h2>
                        <p>Opciones de gesti√≥n de datos y configuraci√≥n</p>
                    </div>
                    <div class="content-body">
                        <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 197, 253, 0.05)); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px;">
                            <h3>Exportaci√≥n de Datos</h3>
                            <p>Descarga tus datos de juego para respaldo o an√°lisis externo</p>
                            
                            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1.5rem;">
                                <button class="btn btn-primary" onclick="exportData()">
                                    <i class="fas fa-download"></i>
                                    Exportar JSON
                                </button>
                                <button class="btn btn-secondary" onclick="exportReport()">
                                    <i class="fas fa-file-alt"></i>
                                    Generar Reporte
                                </button>
                            </div>
                        </div>

                        <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 197, 253, 0.05)); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 12px; margin-top: 2rem;">
                            <h3>Importaci√≥n de Datos</h3>
                            <p>Importa datos previamente exportados</p>
                            
                            <div class="form-group">
                                <input type="file" id="import-file" class="form-input" accept=".json" onchange="importData(event)">
                            </div>
                        </div>

                        <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(248, 113, 113, 0.05)); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px; margin-top: 2rem;">
                            <h3>Herramientas de Diagn√≥stico</h3>
                            <p>Usar solo si hay problemas con el guardado de datos</p>
                            
                            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1.5rem;">
                                <button class="btn btn-secondary" onclick="debugData()">
                                    <i class="fas fa-bug"></i>
                                    Verificar Datos
                                </button>
                                <button class="btn btn-secondary" onclick="testSave()">
                                    <i class="fas fa-vial"></i>
                                    Test LocalStorage
                                </button>
                                <button class="btn btn-danger" onclick="localStorage.clear(); location.reload();">
                                    <i class="fas fa-broom"></i>
                                    Limpiar Todo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Lightning Storm Analytics Dashboard - Implementaci√≥n JavaScript Mejorada
        class LightningStormAnalyzer {
            constructor() {
                this.historial = [];
                this.chart = null;
                this.distanceChart = null;
                this.currentSection = 'data-entry';
                this.settings = {
                    animationsEnabled: true,
                    autoSave: true,
                    notifications: true
                };
                this.loadData();
                this.updateAllDisplays();
                this.initializeEventListeners();
            }

            // Funci√≥n para calcular posici√≥n final en la rueda de 39 casillas
            calculateFinalPosition(startPos, direction, result, isLeaf) {
                // La rueda tiene 39 posiciones: 1, leaf, 2, leaf, 3, leaf, ..., 19, leaf, 20
                // Posiciones impares (1,3,5...39) = n√∫meros, Posiciones pares (2,4,6...38) = leaf
                
                let finalPos;
                
                if (isLeaf) {
                    // Si es leaf, buscar la posici√≥n par m√°s cercana
                    finalPos = this.findLeafPosition(startPos, direction);
                } else {
                    // Si es n√∫mero, calcular posici√≥n del n√∫mero espec√≠fico
                    if (result === 20) {
                        finalPos = 39; // El 20 est√° en la posici√≥n 39
                    } else {
                        finalPos = (result * 2) - 1; // N√∫meros en posiciones impares
                    }
                }
                
                return finalPos;
            }

            // Encontrar posici√≥n leaf m√°s probable basada en direcci√≥n
            findLeafPosition(startPos, direction) {
                const leafPositions = [];
                for (let i = 2; i <= 38; i += 2) {
                    leafPositions.push(i);
                }
                
                // Simplificaci√≥n: retornar una posici√≥n leaf aleatoria
                // En implementaci√≥n real, usar√≠as patrones m√°s complejos
                return leafPositions[Math.floor(Math.random() * leafPositions.length)];
            }

            // Calcular distancia entre posiciones
            calculateDistance(startPos, endPos, direction) {
                let distance;
                
                if (direction === 'right') {
                    if (endPos >= startPos) {
                        distance = endPos - startPos;
                    } else {
                        distance = (39 - startPos) + endPos;
                    }
                } else { // left
                    if (startPos >= endPos) {
                        distance = startPos - endPos;
                    } else {
                        distance = startPos + (39 - endPos);
                    }
                }
                
                return distance;
            }

            // Gesti√≥n de Datos
            loadData() {
                try {
                    const data = localStorage.getItem('lightning_storm_data');
                    if (data) {
                        const parsed = JSON.parse(data);
                        this.historial = parsed.historial || [];
                        if (this.historial.length > 0) {
                            console.log(`Datos cargados: ${this.historial.length} giros`);
                        }
                    } else {
                        this.historial = [];
                        console.log('No hay datos guardados, iniciando historial vac√≠o');
                    }
                } catch (e) {
                    console.error('Error cargando datos:', e);
                    this.historial = [];
                    this.showAlert('danger', 'Error al cargar datos guardados');
                }
            }

            saveData() {
                try {
                    const data = {
                        historial: this.historial,
                        fecha_guardado: new Date().toISOString(),
                        version: '2.0'
                    };
                    localStorage.setItem('lightning_storm_data', JSON.stringify(data));
                    console.log(`Datos guardados: ${this.historial.length} giros`);
                    return true;
                } catch (e) {
                    console.error('Error guardando datos:', e);
                    this.showAlert('danger', 'Error al guardar datos - Posible falta de espacio');
                    return false;
                }
            }

            // Verificar estado de datos
            verifyData() {
                const issues = [];
                
                // Verificar estructura de cada entrada
                this.historial.forEach((entry, index) => {
                    if (!entry.resultado || !entry.posicionInicial || !entry.direccion) {
                        issues.push(`Entrada ${index + 1}: Datos incompletos`);
                    }
                    
                    if (entry.resultado === 'number' && !entry.numero) {
                        issues.push(`Entrada ${index + 1}: Falta n√∫mero`);
                    }
                    
                    if (entry.resultado === 'leaf' && !entry.leaf) {
                        issues.push(`Entrada ${index + 1}: Falta leaf`);
                    }
                });
                
                return issues;
            }

            // Actualizar todas las visualizaciones
            updateAllDisplays() {
                this.updateHeaderStats();
                this.updateAnalytics();
                this.updatePatterns();
                this.updateHistory();
                this.updateNumbersGrid();
                this.updateStartPositionsGrid();
                this.updateRecommendations();
            }

            // Actualizar estad√≠sticas del header
            updateHeaderStats() {
                const totalRounds = this.historial.length;
                const bonusCount = this.historial.filter(r => r.bonus === true).length;
                const bonusRate = totalRounds > 0 ? Math.round((bonusCount / totalRounds) * 100) : 0;
                
                document.getElementById('header-total-rounds').textContent = totalRounds;
                document.getElementById('header-success-rate').textContent = `${bonusRate}%`;
            }

            // Actualizar panel de an√°lisis
            updateAnalytics() {
                const totalRounds = this.historial.length;
                const bonusCount = this.historial.filter(r => r.bonus === true).length;
                const leafCount = this.historial.filter(r => r.resultado === 'leaf').length;
                const bonusRate = totalRounds > 0 ? Math.round((bonusCount / totalRounds) * 100) : 0;
                const leafRate = totalRounds > 0 ? Math.round((leafCount / totalRounds) * 100) : 0;
                
                // Calcular racha actual
                let currentStreak = 0;
                for (let i = this.historial.length - 1; i >= 0; i--) {
                    if (this.historial[i].bonus === false) {
                        currentStreak++;
                    } else {
                        break;
                    }
                }
                
                document.getElementById('total-rounds').textContent = totalRounds;
                document.getElementById('bonus-rate').textContent = `${bonusRate}%`;
                document.getElementById('current-streak').textContent = currentStreak;
                document.getElementById('leaf-rate').textContent = `${leafRate}%`;
            }

            // Actualizar an√°lisis de patrones
            updatePatterns() {
                const rightSpins = this.historial.filter(r => r.direccion === 'right');
                const leftSpins = this.historial.filter(r => r.direccion === 'left');
                
                // Giros a la derecha
                const rightBonusCount = rightSpins.filter(r => r.bonus === true).length;
                const rightLeafCount = rightSpins.filter(r => r.resultado === 'leaf').length;
                const rightAvgDistance = rightSpins.length > 0 
                    ? Math.round(rightSpins.reduce((sum, r) => sum + r.distancia, 0) / rightSpins.length)
                    : 0;
                const rightBonusRate = rightSpins.length > 0 
                    ? Math.round((rightBonusCount / rightSpins.length) * 100) 
                    : 0;
                const rightLeafRate = rightSpins.length > 0 
                    ? Math.round((rightLeafCount / rightSpins.length) * 100) 
                    : 0;
                
                document.getElementById('right-spins-count').textContent = rightSpins.length;
                document.getElementById('right-avg-distance').textContent = rightAvgDistance;
                document.getElementById('right-bonus-rate').textContent = `${rightBonusRate}%`;
                document.getElementById('right-leaf-rate').textContent = `${rightLeafRate}%`;
                
                // Giros a la izquierda
                const leftBonusCount = leftSpins.filter(r => r.bonus === true).length;
                const leftLeafCount = leftSpins.filter(r => r.resultado === 'leaf').length;
                const leftAvgDistance = leftSpins.length > 0 
                    ? Math.round(leftSpins.reduce((sum, r) => sum + r.distancia, 0) / leftSpins.length)
                    : 0;
                const leftBonusRate = leftSpins.length > 0 
                    ? Math.round((leftBonusCount / leftSpins.length) * 100) 
                    : 0;
                const leftLeafRate = leftSpins.length > 0 
                    ? Math.round((leftLeafCount / leftSpins.length) * 100) 
                    : 0;
                
                document.getElementById('left-spins-count').textContent = leftSpins.length;
                document.getElementById('left-avg-distance').textContent = leftAvgDistance;
                document.getElementById('left-bonus-rate').textContent = `${leftBonusRate}%`;
                document.getElementById('left-leaf-rate').textContent = `${leftLeafRate}%`;
                
                // Actualizar an√°lisis de rangos
                this.updateRangeAnalysis();
                
                // Actualizar gr√°fico de distancias
                this.updateDistanceChart();
            }

            // Actualizar an√°lisis de rangos
            updateRangeAnalysis() {
                const rangeList = document.getElementById('range-analysis-list');
                rangeList.innerHTML = '';
                
                // Analizar rangos de distancia
                const ranges = [
                    { min: 0, max: 10, label: 'Corta (0-10)' },
                    { min: 11, max: 20, label: 'Media (11-20)' },
                    { min: 21, max: 30, label: 'Larga (21-30)' },
                    { min: 31, max: 39, label: 'Muy Larga (31-39)' }
                ];
                
                ranges.forEach(range => {
                    const spinsInRange = this.historial.filter(r => r.distancia >= range.min && r.distancia <= range.max);
                    const bonusInRange = spinsInRange.filter(r => r.bonus === true).length;
                    const bonusRate = spinsInRange.length > 0 
                        ? Math.round((bonusInRange / spinsInRange.length) * 100) 
                        : 0;
                    
                    const rangeItem = document.createElement('div');
                    rangeItem.className = 'range-item';
                    rangeItem.innerHTML = `
                        <span>${range.label}</span>
                        <span>${spinsInRange.length} giros (${bonusRate}% bonus)</span>
                    `;
                    rangeList.appendChild(rangeItem);
                });
            }

            // Actualizar gr√°fico de distancias
            updateDistanceChart() {
                const ctx = document.getElementById('distanceChart').getContext('2d');
                
                if (this.distanceChart) {
                    this.distanceChart.destroy();
                }
                
                // Preparar datos
                const rightDistances = this.historial
                    .filter(r => r.direccion === 'right')
                    .map(r => r.distancia);
                
                const leftDistances = this.historial
                    .filter(r => r.direccion === 'left')
                    .map(r => r.distancia);
                
                // Crear histogramas
                const rightHistogram = this.createHistogram(rightDistances, 10);
                const leftHistogram = this.createHistogram(leftDistances, 10);
                
                this.distanceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Array.from({length: 10}, (_, i) => `${i*4}-${(i+1)*4-1}`),
                        datasets: [
                            {
                                label: 'Derecha',
                                data: rightHistogram,
                                backgroundColor: 'rgba(59, 130, 246, 0.7)',
                                borderColor: 'rgba(59, 130, 246, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Izquierda',
                                data: leftHistogram,
                                backgroundColor: 'rgba(239, 68, 68, 0.7)',
                                borderColor: 'rgba(239, 68, 68, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#cbd5e1'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#cbd5e1'
                                },
                                grid: {
                                    color: 'rgba(148, 163, 184, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#cbd5e1'
                                },
                                grid: {
                                    color: 'rgba(148, 163, 184, 0.1)'
                                }
                            }
                        }
                    }
                });
            }

            // Crear histograma para distribuci√≥n
            createHistogram(data, bins) {
                const histogram = new Array(bins).fill(0);
                const max = Math.max(...data, 39);
                const binSize = max / bins;
                
                data.forEach(value => {
                    const binIndex = Math.min(Math.floor(value / binSize), bins - 1);
                    histogram[binIndex]++;
                });
                
                return histogram;
            }

            // Actualizar grilla de n√∫meros
            updateNumbersGrid() {
                const grid = document.getElementById('numbers-grid');
                grid.innerHTML = '';
                
                // Analizar cada n√∫mero
                for (let i = 1; i <= 20; i++) {
                    const numberData = this.historial.filter(r => r.resultado === 'number' && r.numero === i);
                    const total = numberData.length;
                    const bonusCount = numberData.filter(r => r.bonus === true).length;
                    const bonusRate = total > 0 ? Math.round((bonusCount / total) * 100) : 0;
                    
                    // Determinar si es "caliente" o "fr√≠o"
                    let cardClass = 'number-card';
                    if (total > 0) {
                        if (bonusRate > 30) {
                            cardClass += ' hot';
                        } else if (bonusRate < 10) {
                            cardClass += ' cold';
                        }
                    }
                    
                    const card = document.createElement('div');
                    card.className = cardClass;
                    card.innerHTML = `
                        <div class="number-value">${i}</div>
                        <div class="number-stats">
                            <span>Apariciones: ${total}</span>
                            <span>Bonus: ${bonusRate}%</span>
                        </div>
                    `;
                    grid.appendChild(card);
                }
            }

            // Actualizar grilla de posiciones iniciales
            updateStartPositionsGrid() {
                const grid = document.getElementById('start-positions-grid');
                grid.innerHTML = '';
                
                // Analizar cada posici√≥n inicial
                for (let i = 1; i <= 39; i++) {
                    const positionData = this.historial.filter(r => r.posicionInicial === i);
                    const total = positionData.length;
                    const bonusCount = positionData.filter(r => r.bonus === true).length;
                    const bonusRate = total > 0 ? Math.round((bonusCount / total) * 100) : 0;
                    
                    // Determinar si es "caliente" o "fr√≠o"
                    let cardClass = 'number-card';
                    if (total > 0) {
                        if (bonusRate > 30) {
                            cardClass += ' hot';
                        } else if (bonusRate < 10) {
                            cardClass += ' cold';
                        }
                    }
                    
                    const card = document.createElement('div');
                    card.className = cardClass;
                    card.innerHTML = `
                        <div class="number-value">${i}</div>
                        <div class="number-stats">
                            <span>Usos: ${total}</span>
                            <span>Bonus: ${bonusRate}%</span>
                        </div>
                    `;
                    grid.appendChild(card);
                }
            }

            // Actualizar recomendaciones
            updateRecommendations() {
                const list = document.getElementById('recommendations-list');
                list.innerHTML = '';
                
                if (this.historial.length === 0) {
                    list.innerHTML = '<p>No hay suficientes datos para generar recomendaciones</p>';
                    return;
                }
                
                // Analizar patrones para generar recomendaciones
                const recommendations = [];
                
                // Recomendaci√≥n basada en direcci√≥n
                const rightSpins = this.historial.filter(r => r.direccion === 'right');
                const leftSpins = this.historial.filter(r => r.direccion === 'left');
                
                if (rightSpins.length > leftSpins.length) {
                    recommendations.push({
                        type: 'success',
                        text: 'Los giros a la derecha han sido m√°s frecuentes. Considera esta direcci√≥n.'
                    });
                } else if (leftSpins.length > rightSpins.length) {
                    recommendations.push({
                        type: 'success',
                        text: 'Los giros a la izquierda han sido m√°s frecuentes. Considera esta direcci√≥n.'
                    });
                }
                
                // Recomendaci√≥n basada en racha
                let currentStreak = 0;
                for (let i = this.historial.length - 1; i >= 0; i--) {
                    if (this.historial[i].bonus === false) {
                        currentStreak++;
                    } else {
                        break;
                    }
                }
                
                if (currentStreak > 10) {
                    recommendations.push({
                        type: 'warning',
                        text: `Llevas ${currentStreak} giros sin bonus. Podr√≠as estar cerca de uno.`
                    });
                }
                
                // Recomendaci√≥n basada en n√∫meros
                const numberStats = {};
                for (let i = 1; i <= 20; i++) {
                    const numberData = this.historial.filter(r => r.resultado === 'number' && r.numero === i);
                    const total = numberData.length;
                    const bonusCount = numberData.filter(r => r.bonus === true).length;
                    const bonusRate = total > 0 ? (bonusCount / total) : 0;
                    numberStats[i] = { total, bonusRate };
                }
                
                // Encontrar n√∫mero con mejor tasa de bonus
                let bestNumber = null;
                let bestRate = 0;
                
                for (const [num, stats] of Object.entries(numberStats)) {
                    if (stats.total >= 3 && stats.bonusRate > bestRate) {
                        bestNumber = num;
                        bestRate = stats.bonusRate;
                    }
                }
                
                if (bestNumber) {
                    recommendations.push({
                        type: 'success',
                        text: `El n√∫mero ${bestNumber} tiene la mejor tasa de bonus (${Math.round(bestRate * 100)}%).`
                    });
                }
                
                // Mostrar recomendaciones
                if (recommendations.length === 0) {
                    recommendations.push({
                        type: 'warning',
                        text: 'Contin√∫a recolectando datos para obtener recomendaciones m√°s precisas.'
                    });
                }
                
                recommendations.forEach(rec => {
                    const item = document.createElement('div');
                    item.className = `alert alert-${rec.type}`;
                    item.innerHTML = `
                        <i class="fas fa-${rec.type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                        <span>${rec.text}</span>
                    `;
                    list.appendChild(item);
                });
            }

            // Actualizar historial
            updateHistory() {
                const tbody = document.getElementById('history-tbody');
                tbody.innerHTML = '';
                
                // Mostrar √∫ltimos 50 giros
                const recentHistory = this.historial.slice(-50).reverse();
                
                recentHistory.forEach((round, index) => {
                    const row = document.createElement('tr');
                    const resultText = round.resultado === 'number' 
                        ? `N√∫mero ${round.numero}` 
                        : 'Leaf';
                    const directionText = round.direccion === 'right' 
                        ? 'Derecha' 
                        : 'Izquierda';
                    const bonusText = round.bonus 
                        ? '<span style="color: var(--success-green);">S√≠</span>' 
                        : '<span style="color: var(--danger-red);">No</span>';
                    
                    row.innerHTML = `
                        <td>${this.historial.length - index}</td>
                        <td>${resultText}</td>
                        <td>${round.posicionInicial}</td>
                        <td>${directionText}</td>
                        <td>${round.distancia}</td>
                        <td>${bonusText}</td>
                        <td>${round.multiplicador}x</td>
                        <td>${new Date(round.fecha).toLocaleString()}</td>
                    `;
                    tbody.appendChild(row);
                });
                
                if (recentHistory.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No hay datos disponibles</td></tr>';
                }
            }

            // Inicializar event listeners
            initializeEventListeners() {
                // Event listeners para los formularios
                document.getElementById('result-type').addEventListener('change', this.toggleResultFields.bind(this));
                
                // Event listeners para los botones de navegaci√≥n
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const sectionId = item.getAttribute('onclick').match(/'([^']+)'/)[1];
                        this.showSection(sectionId);
                    });
                });
            }

            // Mostrar notificaci√≥n
            showNotification(type, message) {
                if (!this.settings.notifications) return;
                
                const notification = document.createElement('div');
                notification.className = `alert alert-${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                    <span>${message}</span>
                `;
                
                // Posicionamiento y animaci√≥n
                notification.style.position = 'fixed';
                notification.style.bottom = '20px';
                notification.style.right = '20px';
                notification.style.zIndex = '1000';
                notification.style.animation = 'slideInRight 0.3s ease-out';
                
                document.body.appendChild(notification);
                
                // Auto-eliminaci√≥n despu√©s de 3 segundos
                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            // Mostrar alerta
            showAlert(type, message) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                    <span>${message}</span>
                `;
                
                // Insertar despu√©s del header
                const header = document.querySelector('.header');
                header.parentNode.insertBefore(alertDiv, header.nextSibling);
                
                // Auto-eliminaci√≥n despu√©s de 5 segundos
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.parentNode.removeChild(alertDiv);
                    }
                }, 5000);
            }

            // Cambiar secci√≥n
            showSection(sectionId) {
                // Ocultar todas las secciones
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Mostrar secci√≥n seleccionada
                document.getElementById(sectionId).classList.add('active');
                
                // Actualizar navegaci√≥n
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                document.querySelector(`[onclick="showSection('${sectionId}')"]`).classList.add('active');
                
                this.currentSection = sectionId;
                
                // Actualizar visualizaciones espec√≠ficas de la secci√≥n
                if (sectionId === 'visualization') {
                    this.showChart('frequency');
                } else if (sectionId === 'patterns') {
                    this.updatePatterns();
                }
            }

            // Alternar campos seg√∫n tipo de resultado
            toggleResultFields() {
                const resultType = document.getElementById('result-type').value;
                const numberGroup = document.getElementById('number-group');
                
                if (resultType === 'number') {
                    numberGroup.style.display = 'flex';
                } else {
                    numberGroup.style.display = 'none';
                }
            }

            // Agregar nuevo giro
            addRound() {
                // Obtener valores del formulario
                const resultType = document.getElementById('result-type').value;
                const numberInput = document.getElementById('number-input').value;
                const startPosition = parseInt(document.getElementById('start-position').value);
                const direction = document.getElementById('spin-direction').value;
                const bonus = document.getElementById('bonus-input').value === 'true';
                const multiplier = parseFloat(document.getElementById('multiplier-input').value);
                
                // Validar datos
                if (!startPosition || startPosition < 1 || startPosition > 39) {
                    this.showAlert('danger', 'Posici√≥n inicial inv√°lida');
                    return;
                }
                
                if (resultType === 'number' && (!numberInput || numberInput < 1 || numberInput > 20)) {
                    this.showAlert('danger', 'N√∫mero inv√°lido');
                    return;
                }
                
                // Calcular posici√≥n final y distancia
                const isLeaf = resultType === 'leaf';
                const result = isLeaf ? null : parseInt(numberInput);
                const finalPosition = this.calculateFinalPosition(startPosition, direction, result, isLeaf);
                const distance = this.calculateDistance(startPosition, finalPosition, direction);
                
                // Crear objeto de giro
                const round = {
                    resultado: resultType,
                    numero: result,
                    posicionInicial: startPosition,
                    direccion: direction,
                    distancia: distance,
                    bonus: bonus,
                    multiplicador: multiplier,
                    fecha: new Date().toISOString()
                };
                
                // Agregar al historial
                this.historial.push(round);
                
                // Guardar datos
                if (this.saveData()) {
                    // Actualizar visualizaciones
                    this.updateAllDisplays();
                    
                    // Mostrar notificaci√≥n
                    this.showNotification('success', 'Giro agregado correctamente');
                    
                    // Limpiar formulario
                    this.clearForm();
                    
                    // Mostrar resultado
                    this.showAddResult(round);
                }
            }

            // Limpiar formulario
            clearForm() {
                document.getElementById('number-input').value = '';
                document.getElementById('start-position').value = '';
                document.getElementById('bonus-input').value = 'false';
                document.getElementById('multiplier-input').value = '1.0';
            }

            // Mostrar resultado agregado
            showAddResult(round) {
                const resultDiv = document.getElementById('add-result');
                const resultText = round.resultado === 'number' 
                    ? `N√∫mero ${round.numero}` 
                    : 'Leaf';
                const directionText = round.direccion === 'right' 
                    ? 'Derecha' 
                    : 'Izquierda';
                
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i>
                        <span>
                            Giro agregado: ${resultText} | 
                            Posici√≥n inicial: ${round.posicionInicial} | 
                            Direcci√≥n: ${directionText} | 
                            Distancia: ${round.distancia} | 
                            Bonus: ${round.bonus ? 'S√≠' : 'No'}
                        </span>
                    </div>
                `;
                
                // Auto-eliminar despu√©s de 5 segundos
                setTimeout(() => {
                    resultDiv.innerHTML = '';
                }, 5000);
            }

            // Modo r√°pido de entrada
            quickAddMode() {
                // Implementaci√≥n simplificada para entrada r√°pida
                this.showAlert('warning', 'Modo r√°pido: Ingresa solo posici√≥n inicial y direcci√≥n');
                
                // Ocultar campos no esenciales
                document.getElementById('number-group').style.display = 'none';
                document.getElementById('bonus-group').style.display = 'none';
                document.getElementById('multiplier-group').style.display = 'none';
                
                // Establecer valores por defecto
                document.getElementById('result-type').value = 'number';
                document.getElementById('number-input').value = Math.floor(Math.random() * 20) + 1;
                document.getElementById('bonus-input').value = 'false';
                document.getElementById('multiplier-input').value = '1.0';
            }

            // Ejecutar simulaci√≥n Monte Carlo
            runSimulation() {
                const simRounds = parseInt(document.getElementById('sim-rounds').value);
                const simCount = parseInt(document.getElementById('sim-count').value);
                const startPos = parseInt(document.getElementById('sim-start-pos').value);
                const direction = document.getElementById('sim-direction').value;
                
                // Validar par√°metros
                if (simRounds < 1 || simRounds > 100) {
                    this.showAlert('danger', 'Giros de simulaci√≥n deben estar entre 1 y 100');
                    return;
                }
                
                if (simCount < 100 || simCount > 10000) {
                    this.showAlert('danger', 'Cantidad de simulaciones debe estar entre 100 y 10000');
                    return;
                }
                
                // Mostrar loading
                document.getElementById('sim-loading').style.display = 'block';
                document.getElementById('simulation-results').style.display = 'none';
                
                // Ejecutar simulaci√≥n en background
                setTimeout(() => {
                    const results = this.performMonteCarloSimulation(simRounds, simCount, startPos, direction);
                    this.displaySimulationResults(results);
                    
                    // Ocultar loading y mostrar resultados
                    document.getElementById('sim-loading').style.display = 'none';
                    document.getElementById('simulation-results').style.display = 'block';
                }, 100);
            }

            // Realizar simulaci√≥n Monte Carlo
            performMonteCarloSimulation(rounds, count, startPos, direction) {
                const results = {
                    totalBonus: 0,
                    totalLeaf: 0,
                    avgDistance: 0,
                    bestDirection: null,
                    worstDirection: null,
                    bestPosition: null,
                    worstPosition: null,
                    directionStats: { right: { bonus: 0, leaf: 0, distance: 0 }, left: { bonus: 0, leaf: 0, distance: 0 } },
                    positionStats: {}
                };
                
                // Inicializar estad√≠sticas de posici√≥n
                for (let i = 1; i <= 39; i++) {
                    results.positionStats[i] = { bonus: 0, leaf: 0, distance: 0, count: 0 };
                }
                
                // Ejecutar simulaciones
                for (let sim = 0; sim < count; sim++) {
                    let simBonus = 0;
                    let simLeaf = 0;
                    let simDistance = 0;
                    let currentPos = startPos;
                    
                    for (let round = 0; round < rounds; round++) {
                        // Determinar direcci√≥n
                        let simDirection = direction;
                        if (direction === 'both') {
                            simDirection = Math.random() < 0.5 ? 'right' : 'left';
                        }
                        
                        // Determinar resultado (simplificado)
                        const isLeaf = Math.random() < 0.3; // 30% probabilidad de leaf
                        const result = isLeaf ? null : Math.floor(Math.random() * 20) + 1;
                        
                        // Calcular posici√≥n final y distancia
                        const finalPos = this.calculateFinalPosition(currentPos, simDirection, result, isLeaf);
                        const distance = this.calculateDistance(currentPos, finalPos, simDirection);
                        
                        // Determinar bonus (simplificado)
                        const bonus = Math.random() < 0.15; // 15% probabilidad de bonus
                        
                        // Actualizar estad√≠sticas
                        if (bonus) simBonus++;
                        if (isLeaf) simLeaf++;
                        simDistance += distance;
                        
                        // Actualizar estad√≠sticas por direcci√≥n
                        results.directionStats[simDirection].bonus += bonus ? 1 : 0;
                        results.directionStats[simDirection].leaf += isLeaf ? 1 : 0;
                        results.directionStats[simDirection].distance += distance;
                        
                        // Actualizar estad√≠sticas por posici√≥n
                        results.positionStats[currentPos].bonus += bonus ? 1 : 0;
                        results.positionStats[currentPos].leaf += isLeaf ? 1 : 0;
                        results.positionStats[currentPos].distance += distance;
                        results.positionStats[currentPos].count++;
                        
                        // Actualizar posici√≥n actual para siguiente ronda
                        currentPos = finalPos;
                    }
                    
                    results.totalBonus += simBonus;
                    results.totalLeaf += simLeaf;
                    results.avgDistance += simDistance;
                }
                
                // Calcular promedios
                results.totalBonus = Math.round((results.totalBonus / count) * 100) / 100;
                results.totalLeaf = Math.round((results.totalLeaf / count) * 100) / 100;
                results.avgDistance = Math.round((results.avgDistance / count) * 100) / 100;
                
                // Calcular mejor y peor direcci√≥n
                const rightBonusRate = results.directionStats.right.bonus / count;
                const leftBonusRate = results.directionStats.left.bonus / count;
                
                if (rightBonusRate > leftBonusRate) {
                    results.bestDirection = 'right';
                    results.worstDirection = 'left';
                } else {
                    results.bestDirection = 'left';
                    results.worstDirection = 'right';
                }
                
                // Calcular mejor y peor posici√≥n
                let bestPos = null;
                let bestPosRate = -1;
                let worstPos = null;
                let worstPosRate = 2;
                
                for (const [pos, stats] of Object.entries(results.positionStats)) {
                    if (stats.count > 0) {
                        const bonusRate = stats.bonus / stats.count;
                        if (bonusRate > bestPosRate) {
                            bestPosRate = bonusRate;
                            bestPos = pos;
                        }
                        if (bonusRate < worstPosRate) {
                            worstPosRate = bonusRate;
                            worstPos = pos;
                        }
                    }
                }
                
                results.bestPosition = bestPos;
                results.worstPosition = worstPos;
                
                return results;
            }

            // Mostrar resultados de simulaci√≥n
            displaySimulationResults(results) {
                const output = document.getElementById('sim-output');
                
                output.innerHTML = `
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-title">Bonus Promedio</span>
                                <div class="metric-icon">
                                    <i class="fas fa-gift"></i>
                                </div>
                            </div>
                            <div class="metric-value">${results.totalBonus}</div>
                            <div class="metric-change">
                                <span>Por simulaci√≥n</span>
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-title">Leaf Promedio</span>
                                <div class="metric-icon">
                                    <i class="fas fa-leaf"></i>
                                </div>
                            </div>
                            <div class="metric-value">${results.totalLeaf}</div>
                            <div class="metric-change">
                                <span>Por simulaci√≥n</span>
                            </div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-title">Distancia Promedio</span>
                                <div class="metric-icon">
                                    <i class="fas fa-route"></i>
                                </div>
                            </div>
                            <div class="metric-value">${results.avgDistance}</div>
                            <div class="metric-change">
                                <span>Por giro</span>
                            </div>
                        </div>
                        
                        <div class="metric-card success">
                            <div class="metric-header">
                                <span class="metric-title">Mejor Direcci√≥n</span>
                                <div class="metric-icon">
                                    <i class="fas fa-arrow-${results.bestDirection === 'right' ? 'right' : 'left'}"></i>
                                </div>
                            </div>
                            <div class="metric-value">${results.bestDirection === 'right' ? '‚Üí' : '‚Üê'}</div>
                            <div class="metric-change">
                                <span>${results.bestDirection === 'right' ? 'Derecha' : 'Izquierda'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="range-analysis">
                        <div class="range-title">
                            <i class="fas fa-lightbulb"></i>
                            Recomendaciones de Simulaci√≥n
                        </div>
                        <div class="range-item">
                            <span>Mejor posici√≥n inicial</span>
                            <span>${results.bestPosition || 'N/A'}</span>
                        </div>
                        <div class="range-item">
                            <span>Evitar posici√≥n inicial</span>
                            <span>${results.worstPosition || 'N/A'}</span>
                        </div>
                        <div class="range-item">
                            <span>Tasa de bonus esperada</span>
                            <span>${Math.round(results.totalBonus * 100 / parseInt(document.getElementById('sim-rounds').value))}%</span>
                        </div>
                    </div>
                `;
            }

            // Exportar resultados de simulaci√≥n
            exportSimulation() {
                const results = document.getElementById('sim-output').innerHTML;
                
                if (!results) {
                    this.showAlert('warning', 'Ejecuta una simulaci√≥n primero');
                    return;
                }
                
                // Crear contenido para exportar
                const content = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Resultados de Simulaci√≥n - Lightning Storm</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; background: #0f172a; color: #f8fafc; }
                            .metric-card { background: rgba(30, 41, 59, 0.6); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; }
                            .metric-value { font-size: 2rem; font-weight: bold; }
                            .range-item { background: rgba(30, 41, 59, 0.4); padding: 1rem; margin-bottom: 0.5rem; border-radius: 8px; }
                        </style>
                    </head>
                    <body>
                        <h1>Resultados de Simulaci√≥n Monte Carlo</h1>
                        <p>Generado el: ${new Date().toLocaleString()}</p>
                        ${results}
                    </body>
                    </html>
                `;
                
                // Descargar archivo
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `simulacion_${new Date().toISOString().slice(0, 10)}.html`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showNotification('success', 'Resultados exportados correctamente');
            }

            // Mostrar gr√°fico
            showChart(chartType) {
                const ctx = document.getElementById('mainChart').getContext('2d');
                
                if (this.chart) {
                    this.chart.destroy();
                }
                
                let chartData;
                let chartOptions = {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#cbd5e1'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#cbd5e1'
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#cbd5e1'
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        }
                    }
                };
                
                switch (chartType) {
                    case 'frequency':
                        // Gr√°fico de frecuencia de n√∫meros
                        const numberFreq = new Array(20).fill(0);
                        this.historial.forEach(round => {
                            if (round.resultado === 'number' && round.numero) {
                                numberFreq[round.numero - 1]++;
                            }
                        });
                        
                        chartData = {
                            labels: Array.from({length: 20}, (_, i) => i + 1),
                            datasets: [{
                                label: 'Frecuencia',
                                data: numberFreq,
                                backgroundColor: 'rgba(59, 130, 246, 0.7)',
                                borderColor: 'rgba(59, 130, 246, 1)',
                                borderWidth: 1
                            }]
                        };
                        
                        this.chart = new Chart(ctx, {
                            type: 'bar',
                            data: chartData,
                            options: chartOptions
                        });
                        break;
                        
                    case 'bonus':
                        // Gr√°fico de bonus por n√∫mero
                        const bonusRates = new Array(20).fill(0);
                        const appearances = new Array(20).fill(0);
                        
                        this.historial.forEach(round => {
                            if (round.resultado === 'number' && round.numero) {
                                appearances[round.numero - 1]++;
                                if (round.bonus) {
                                    bonusRates[round.numero - 1]++;
                                }
                            }
                        });
                        
                        // Calcular tasas
                        for (let i = 0; i < 20; i++) {
                            if (appearances[i] > 0) {
                                bonusRates[i] = Math.round((bonusRates[i] / appearances[i]) * 100);
                            } else {
                                bonusRates[i] = 0;
                            }
                        }
                        
                        chartData = {
                            labels: Array.from({length: 20}, (_, i) => i + 1),
                            datasets: [{
                                label: 'Tasa de Bonus (%)',
                                data: bonusRates,
                                backgroundColor: 'rgba(16, 185, 129, 0.7)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1
                            }]
                        };
                        
                        this.chart = new Chart(ctx, {
                            type: 'bar',
                            data: chartData,
                            options: chartOptions
                        });
                        break;
                        
                    case 'direction':
                        // Gr√°fico de an√°lisis direccional
                        const rightCount = this.historial.filter(r => r.direccion === 'right').length;
                        const leftCount = this.historial.filter(r => r.direccion === 'left').length;
                        
                        chartData = {
                            labels: ['Derecha', 'Izquierda'],
                            datasets: [{
                                label: 'Cantidad de Giros',
                                data: [rightCount, leftCount],
                                backgroundColor: [
                                    'rgba(59, 130, 246, 0.7)',
                                    'rgba(239, 68, 68, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(59, 130, 246, 1)',
                                    'rgba(239, 68, 68, 1)'
                                ],
                                borderWidth: 1
                            }]
                        };
                        
                        this.chart = new Chart(ctx, {
                            type: 'doughnut',
                            data: chartData,
                            options: chartOptions
                        });
                        break;
                        
                    case 'timeline':
                        // Gr√°fico de l√≠nea de tiempo
                        const timelineData = [];
                        const bonusTimeline = [];
                        
                        // Agrupar por d√≠a
                        const dailyData = {};
                        this.historial.forEach(round => {
                            const date = new Date(round.fecha).toLocaleDateString();
                            if (!dailyData[date]) {
                                dailyData[date] = { total: 0, bonus: 0 };
                            }
                            dailyData[date].total++;
                            if (round.bonus) {
                                dailyData[date].bonus++;
                            }
                        });
                        
                        // Preparar datos para gr√°fico
                        Object.keys(dailyData).sort().forEach(date => {
                            timelineData.push(date);
                            const rate = Math.round((dailyData[date].bonus / dailyData[date].total) * 100);
                            bonusTimeline.push(rate);
                        });
                        
                        chartData = {
                            labels: timelineData,
                            datasets: [{
                                label: 'Tasa de Bonus (%)',
                                data: bonusTimeline,
                                backgroundColor: 'rgba(245, 158, 11, 0.2)',
                                borderColor: 'rgba(245, 158, 11, 1)',
                                borderWidth: 2,
                                tension: 0.4
                            }]
                        };
                        
                        this.chart = new Chart(ctx, {
                            type: 'line',
                            data: chartData,
                            options: chartOptions
                        });
                        break;
                }
            }

            // Actualizar historial
            refreshHistory() {
                this.updateHistory();
                this.showNotification('success', 'Historial actualizado');
            }

            // Limpiar historial
            clearHistory() {
                if (confirm('¬øEst√°s seguro de que quieres eliminar todo el historial? Esta acci√≥n no se puede deshacer.')) {
                    this.historial = [];
                    this.saveData();
                    this.updateAllDisplays();
                    this.showNotification('success', 'Historial eliminado correctamente');
                }
            }

            // Exportar datos
            exportData() {
                const data = {
                    historial: this.historial,
                    fecha_exportacion: new Date().toISOString(),
                    version: '2.0'
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `lightning_storm_data_${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showNotification('success', 'Datos exportados correctamente');
            }

            // Generar reporte
            exportReport() {
                const totalRounds = this.historial.length;
                const bonusCount = this.historial.filter(r => r.bonus === true).length;
                const leafCount = this.historial.filter(r => r.resultado === 'leaf').length;
                const bonusRate = totalRounds > 0 ? Math.round((bonusCount / totalRounds) * 100) : 0;
                const leafRate = totalRounds > 0 ? Math.round((leafCount / totalRounds) * 100) : 0;
                
                const report = `
# Reporte de Lightning Storm Analytics

**Fecha de generaci√≥n:** ${new Date().toLocaleString()}

## Resumen General
- **Total de giros:** ${totalRounds}
- **Giros con bonus:** ${bonusCount} (${bonusRate}%)
- **Giros Leaf:** ${leafCount} (${leafRate}%)

## An√°lisis por Direcci√≥n
### Giros a la Derecha
- **Total:** ${this.historial.filter(r => r.direccion === 'right').length}
- **Tasa de bonus:** ${document.getElementById('right-bonus-rate').textContent}
- **Distancia promedio:** ${document.getElementById('right-avg-distance').textContent}

### Giros a la Izquierda
- **Total:** ${this.historial.filter(r => r.direccion === 'left').length}
- **Tasa de bonus:** ${document.getElementById('left-bonus-rate').textContent}
- **Distancia promedio:** ${document.getElementById('left-avg-distance').textContent}

## Recomendaciones
 ${document.getElementById('recommendations-list').innerText}

---
*Generado por Lightning Storm Analytics v2.0*
                `;
                
                const blob = new Blob([report], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `reporte_${new Date().toISOString().slice(0, 10)}.md`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showNotification('success', 'Reporte generado correctamente');
            }

            // Importar datos
            importData(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.historial && Array.isArray(data.historial)) {
                            if (confirm('¬øImportar ' + data.historial.length + ' giros? Esto reemplazar√° tus datos actuales.')) {
                                this.historial = data.historial;
                                this.saveData();
                                this.updateAllDisplays();
                                this.showNotification('success', 'Datos importados correctamente');
                            }
                        } else {
                            this.showAlert('danger', 'Formato de archivo inv√°lido');
                        }
                    } catch (error) {
                        this.showAlert('danger', 'Error al procesar el archivo');
                    }
                };
                reader.readAsText(file);
                
                // Limpiar input
                event.target.value = '';
            }

            // Depurar datos
            debugData() {
                const issues = this.verifyData();
                
                if (issues.length === 0) {
                    this.showNotification('success', 'Todos los datos son v√°lidos');
                } else {
                    const issuesText = issues.join('\n');
                    alert('Problemas encontrados:\n\n' + issuesText);
                }
            }

            // Probar almacenamiento local
            testSave() {
                const testData = { test: true, timestamp: new Date().toISOString() };
                
                try {
                    localStorage.setItem('lightning_storm_test', JSON.stringify(testData));
                    const retrieved = JSON.parse(localStorage.getItem('lightning_storm_test'));
                    
                    if (retrieved.test === true) {
                        this.showNotification('success', 'LocalStorage funciona correctamente');
                    } else {
                        this.showAlert('danger', 'Error en la recuperaci√≥n de datos');
                    }
                    
                    localStorage.removeItem('lightning_storm_test');
                } catch (e) {
                    this.showAlert('danger', 'LocalStorage no est√° disponible');
                }
            }
        }

        // Inicializar aplicaci√≥n
        let analyzer;
        document.addEventListener('DOMContentLoaded', () => {
            analyzer = new LightningStormAnalyzer();
        });

        // Funciones globales para eventos
        function showSection(sectionId) {
            analyzer.showSection(sectionId);
        }

        function toggleResultFields() {
            analyzer.toggleResultFields();
        }

        function addRound() {
            analyzer.addRound();
        }

        function quickAddMode() {
            analyzer.quickAddMode();
        }

        function runSimulation() {
            analyzer.runSimulation();
        }

        function exportSimulation() {
            analyzer.exportSimulation();
        }

        function showChart(chartType) {
            analyzer.showChart(chartType);
        }

        function refreshHistory() {
            analyzer.refreshHistory();
        }

        function clearHistory() {
            analyzer.clearHistory();
        }

        function exportData() {
            analyzer.exportData();
        }

        function exportReport() {
            analyzer.exportReport();
        }

        function importData(event) {
            analyzer.importData(event);
        }

        function debugData() {
            analyzer.debugData();
        }

        function testSave() {
            analyzer.testSave();
        }
    </script>
</body>
</html>
